


 app with two modes (Normal and Travel). Users select from tabs containing active selectable options (predefined categories; users can also add custom ones where applicable). Every selection creates a persistent row per user+category that is reused forever (not new rows each time). The app must support multi-currency with visual currency switch markers in graphs. Include all details below.
Core Data Logic
	•	On sign-up, generate a userId.
	•	When a user first selects a category in any tab, create one persistent row keyed by (userId, mode, tab, category).
	•	Adding an expense updates that same row’s currentMonthTotal (increment). No duplicate rows for the same (userId, mode, tab, category).
	•	Month end process (automatic on the first load after month change or via a scheduled task):
	1	Save a monthly snapshot (userId, mode, tab, category, month, total, currencyAtEntryWindow).
	2	Reset that row’s currentMonthTotal to 0 while keeping lifetime aggregates intact.
	3	Continue using the same row for the new month, re-accumulating totals.
	•	Goal: minimal rows, efficient storage, reliable monthly history.
Currency Rules
	•	User sets an activeCurrency (e.g., CAD). Each entry is tagged with the row’s activeCurrency at time of entry.
	•	If user later switches currency (e.g., to MAD), future entries use the new currency; historical data remains in original currency.
	•	Graphs show a vertical marker on the switch date and legend labels for currency segments.
	•	Monthly snapshots record the currency used during that month for each row.
Modes, Tabs, and Categories (exhaustive, selectable)
All categories must be active options a user can add to the tab. Include Other in each tab. Users can add custom subcategories where allowed.
Normal Mode
Transportation
	•	Car purchase/loan, Car insurance, Fuel (gas/electric/hybrid), Maintenance (oil, tires, inspections), Repairs, Parts & accessories, Registration/licensing, Roadside assistance, Tolls, Parking (street/garage/monthly), Public transit (fares/passes), Rideshare/taxi, Bike/scooter (purchase/maintenance), Car wash/detailing, Car membership/car-share, Driver’s license renewals, Fines, Other
Accommodation / Housing
	•	Rent, Mortgage, Property taxes, Home/tenant insurance, Electricity, Heating/Hydro, Water/Sewer, Garbage/Recycling fees, Internet, Cable/Streaming for home, Mobile/landline, HOA/condo fees, Security system, Pest control, Cleaning services, Repairs/maintenance, Renovations, Furniture, Appliances, Tools, Storage unit, Moving costs, Landscaping/snow removal, Other
Entertainment & Leisure
	•	Dining out, Cafes, Snacks/treats, Movies, Concerts, Theater, Museums, Sports events, Activity fees (bowling, mini-golf, escape rooms), Subscriptions (Netflix/Spotify/etc.), Gaming (games/DLC/in-app), Hobbies/crafts, Books/e-books/audiobooks, Streaming rentals/PPV, Nightlife (bars/clubs), Events/festivals, Photography/gear, Courses/workshops (non-essential), Gifts (non-essential), Other
Health & Wellness
	•	Gym membership, Fitness classes (yoga, pilates, martial arts), Personal training/coaching, Home fitness equipment, Medicines, Vitamins/supplements, Prescriptions, Pharmacy fees, GP/Family doctor, Specialists, Hospital/ER, Urgent care/clinics, Dental (cleaning, fillings, ortho), Vision (exams, glasses, contacts, surgery), Hearing (exams, aids), Mental health (therapy/counseling), Physiotherapy, Chiropractor, Massage therapy, Acupuncture, Alternative/naturopathy, Lab tests, Medical devices (BP cuff, glucose monitor), Health insurance premiums, Travel vaccines, Other
Essentials
	•	Groceries, Household supplies, Toiletries/personal care, Laundry/dry cleaning, Baby supplies (diapers, formula), School supplies, Tuition/fees (essential), Childcare/babysitting, Transportation passes required for work/school, Pet food/basic care, Basic clothing/shoes, Work uniforms/tools, Cloud storage/phone plan essential tier, Banking fees, Taxes/filing fees, Postage/shipping essentials, Community dues/obligatory fees, Other
Non-Essentials
	•	Memberships (recurring, auto-count monthly): Clubs (golf/social), Premium streaming, Subscription boxes (beauty/wine/merch), Premium apps, Creator memberships/patreon, Magazines/newspapers, Specialty gyms, VIP programs, Game passes, Other
	•	Non-Memberships (one-time): Fashion & accessories, Designer items, Luxury electronics/gadgets, Collectibles, Hobbies/special gear, Décor, Non-essential gifts, Travel splurges, Event splurges, Cosmetics/luxury care, Impulse buys, Other
	◦	For non-memberships: user enters Item name, Amount, Note.
Travel Mode
Transportation (Travel)
	•	Flights (domestic/international), Trains, Buses/coaches, Shuttles, Car rental, Fuel, Taxis/rideshare, Ferries/boats, Cruises, City transport passes/cards, Baggage fees, Seat/upgrade fees, Airport parking, Tolls, Travel insurance (transport), Other
Accommodation (Travel)
	•	Hotels, Hostels, Guesthouses, Vacation rentals (Airbnb), Resorts, Motels, Campsites, Overnight trains/boats, Day rooms, Resort fees, City/lodging taxes, Other
Food & Dining (Travel)
	•	Restaurants, Cafes, Street food, Groceries, Delivery/apps, Room service, Snacks, Water/beverages, Specialty dining/experiences, Other
Entertainment & Activities (Travel)
	•	Tours (city, cultural, adventure), Landmarks/museums, Theme/amusement parks, Beaches/pool passes, Outdoor (hiking, diving, skiing), Gear rental, Shows/concerts/nightlife, Classes/workshops, Souvenirs/shopping, Photography permits, Local SIM/roaming for apps, Other
Essentials (Travel)
	•	Visas/passport fees, Currency exchange/ATM/bank fees, SIM/eSIM/roaming plans, Travel health insurance, Travel meds/vaccines, Safety gear, Emergency fund, Luggage/locks, Power adapters, Local transport cards, Data backups/cloud while traveling, Other
Include Other and allow custom additions in every tab.
UI/UX Requirements
	•	Tabs per mode; within each, show selectable categories as chips/toggles/buttons.
	•	Category detail view shows:
	◦	CurrentMonthTotal (with activeCurrency tag)
	◦	Add amount (+ optional memo, date)
	◦	History (last N adds)
	•	Show currency badge per total and on each line item.
	•	Graphs (per tab, per category, cross-tab):
	◦	Plot monthly totals; draw a vertical marker on currency switch dates.
	◦	Legend segments labeled with currency codes (e.g., “Before: CAD”, “After: MAD”).
	◦	Allow filter by mode/tab/category/date range.
Monthly Roll-Up & Reset (must have)
	•	On month boundary (UTC or user’s timezone), for each (userId, mode, tab, category):
	◦	Create MonthlySnapshot with: monthStart, monthEnd, total, currencyUsed, entryCount.
	◦	Reset currentMonthTotal = 0 (persist lifetimeTotal if tracked).
	◦	Continue using the same row next month.
Edge Cases & Rules
	•	Currency mid-month: snapshot uses the currency at time of each entry; roll-up totals are stored with the currency that predominated or store per-currency subtotals within the snapshot (preferred). Graph still shows switch marker on exact switch date.
	•	User deletes a category: keep snapshots for history; mark row inactive; re-enable if re-selected.
	•	Timezone: use the user’s timezone for month boundaries and switch markers.
	•	Data integrity: operations idempotent; no duplicate rows for same key; safe concurrent updates.
Output I want
	1	The full categorized selectable lists above (Normal + Travel).
	2	A proposed data model (tables/collections + key fields) that supports the one-row-per-category, monthly roll-up, and currency tagging.
	3	The graphing logic description (currency markers, legends, segmentation).
	4	A concise monthly roll-up algorithm (pseudocode).